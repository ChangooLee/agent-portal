#!/bin/bash
# Post-commit hook: í•™ìŠµ ë‚´ìš© ì¶”ì¶œ ë° ì£¼ê°„ ë¦¬ë·° ì•Œë¦¼

echo "ğŸ“š Post-commit: Learning extraction..."

# 1. ì»¤ë°‹ ë©”ì‹œì§€ì—ì„œ "Learning:" í‚¤ì›Œë“œ ì¶”ì¶œ
COMMIT_MSG=$(git log -1 --pretty=%B)
LEARNING=$(echo "$COMMIT_MSG" | grep -i "^Learning:" | sed 's/^Learning://g' | xargs)

if [ -n "$LEARNING" ]; then
    DATE=$(date +%Y-%m-%d)
    COMMIT_HASH=$(git log -1 --pretty=%h)
    
    # í•™ìŠµ ë‚´ìš© ë¶„ë¥˜ (í‚¤ì›Œë“œ ê¸°ë°˜)
    if echo "$COMMIT_MSG" | grep -qi "ui\|svelte\|component\|style"; then
        LEARNING_FILE=".cursor/learnings/ui-patterns.md"
        CATEGORY="UI"
    elif echo "$COMMIT_MSG" | grep -qi "api\|backend\|fastapi\|route"; then
        LEARNING_FILE=".cursor/learnings/api-patterns.md"
        CATEGORY="API"
    elif echo "$COMMIT_MSG" | grep -qi "bug\|fix\|error"; then
        LEARNING_FILE=".cursor/learnings/bug-fixes.md"
        CATEGORY="BUG"
    else
        LEARNING_FILE=".cursor/learnings/preferences.md"
        CATEGORY="GENERAL"
    fi
    
    # í•™ìŠµ ë‚´ìš© ì¶”ê°€
    echo "" >> "$LEARNING_FILE"
    echo "## $DATE: Auto-extracted from commit $COMMIT_HASH" >> "$LEARNING_FILE"
    echo "" >> "$LEARNING_FILE"
    echo "**ë‚´ìš©**: $LEARNING" >> "$LEARNING_FILE"
    echo "**ì»¤ë°‹**: $COMMIT_HASH" >> "$LEARNING_FILE"
    echo "" >> "$LEARNING_FILE"
    echo "---" >> "$LEARNING_FILE"
    
    echo "  âœ… Learning extracted to $LEARNING_FILE"
fi

# 2. ì£¼ê°„ ë¦¬ë·° ì•Œë¦¼ (ë§¤ì£¼ ê¸ˆìš”ì¼)
DAY_OF_WEEK=$(date +%u)  # 1=Monday, 5=Friday
if [ "$DAY_OF_WEEK" -eq 5 ]; then
    echo ""
    echo "ğŸ—“ï¸  Weekly Review Reminder (Friday):"
    echo "     Run: ./scripts/weekly-review.sh"
    echo "     Review learnings and update core documents."
fi

exit 0

