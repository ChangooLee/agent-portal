---
alwaysApply: false
---
# News Feature Development Rules

Rules for the Today page news aggregation feature.

## Overview

The Today page (`/today`) displays AI news with:
- Infinite scroll pagination
- Real-time search
- Importance-based sorting
- Category filtering

## Architecture

```
Today Page
â”œâ”€â”€ News List (infinite scroll)
â”‚   â”œâ”€â”€ NewsCard component
â”‚   â””â”€â”€ IntersectionObserver for pagination
â”œâ”€â”€ Search Input (real-time)
â””â”€â”€ Category Tabs
```

## File Locations

```
webui/src/routes/(app)/today/+page.svelte     # Main page
webui/src/lib/components/news/NewsCard.svelte # Card component
backend/app/routes/news.py                     # API endpoints
backend/app/services/news_service.py           # Business logic
```

## Infinite Scroll Pattern

```svelte
<script>
  import { afterUpdate } from 'svelte';
  
  let observerTarget;
  let loading = false;
  let page = 1;
  let hasMore = true;
  
  afterUpdate(() => {
    if (!observerTarget) return;
    
    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting && hasMore && !loading) {
          loadMore();
        }
      },
      { threshold: 0.1 }
    );
    
    observer.observe(observerTarget);
    return () => observer.disconnect();
  });
  
  async function loadMore() {
    loading = true;
    const newItems = await fetchNews(page + 1);
    if (newItems.length === 0) {
      hasMore = false;
    } else {
      items = [...items, ...newItems];
      page += 1;
    }
    loading = false;
  }
</script>

{#each items as item}
  <NewsCard {item} />
{/each}

<div bind:this={observerTarget} class="h-20" />

{#if loading}
  <div class="text-center py-4">
    <Spinner />
  </div>
{/if}
```

**Important**: Set up IntersectionObserver in `afterUpdate`, not `onMount`, to ensure DOM is ready.

## Real-time Search

```svelte
<script>
  import { debounce } from 'lodash-es';
  
  let searchQuery = '';
  let filteredItems = [];
  
  const debouncedSearch = debounce(async (query) => {
    if (!query.trim()) {
      filteredItems = items;
      return;
    }
    filteredItems = await searchNews(query);
  }, 300);
  
  $: debouncedSearch(searchQuery);
</script>

<input
  type="text"
  bind:value={searchQuery}
  placeholder="Search news..."
  class="w-full px-4 py-2 rounded-lg border..."
/>
```

## Importance Sorting

News items have `importance_score` (0-100) calculated by:
- Source reliability
- Recency
- Topic relevance

```python
# backend/app/services/news_service.py
def calculate_importance(article):
    score = 0
    score += source_weights.get(article.source, 50)
    score += recency_score(article.published_at)
    score += topic_relevance(article.title, article.content)
    return min(100, score)
```

**Display**: Sort by score, but don't show numeric value to users. Use badges instead:
- ðŸ”¥ Hot (score > 80)
- â­ Featured (score > 60)

## API Endpoints

```
GET /api/news
  ?page=1
  &size=20
  &category=ai
  &search=query
  
Response:
{
  "items": [...],
  "total": 100,
  "page": 1,
  "size": 20,
  "has_more": true
}
```

## Category Tabs

```svelte
<script>
  const categories = ['All', 'AI', 'ML', 'LLM', 'Agents'];
  let activeCategory = 'All';
</script>

<div class="flex gap-2 mb-4">
  {#each categories as cat}
    <button
      class="px-4 py-2 rounded-lg transition-all
             {activeCategory === cat 
               ? 'bg-primary text-white' 
               : 'bg-gray-100 hover:bg-gray-200'}"
      on:click={() => activeCategory = cat}
    >
      {cat}
    </button>
  {/each}
</div>
```

## NewsCard Component

```svelte
<div class="bg-white dark:bg-gray-800 rounded-xl p-4 
            border border-gray-200 dark:border-gray-700
            hover:shadow-md transition-shadow">
  <!-- Badge -->
  {#if item.importance_score > 80}
    <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-600">
      ðŸ”¥ Hot
    </span>
  {/if}
  
  <!-- Title -->
  <h3 class="font-semibold text-gray-900 dark:text-white mt-2">
    {item.title}
  </h3>
  
  <!-- Summary -->
  <p class="text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2">
    {item.summary}
  </p>
  
  <!-- Meta -->
  <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
    <span>{item.source}</span>
    <span>â€¢</span>
    <span>{formatDate(item.published_at)}</span>
  </div>
</div>
```

## Key Rules

- Use `afterUpdate` for IntersectionObserver, not `onMount`
- Debounce search input (300ms)
- Don't show numeric importance scores to users
- Sort by importance, display with badges

---

**Last Updated**: 2025-11-28
