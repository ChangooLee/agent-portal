---
name: news-feature
description: News Feature ê°œë°œ ê·œì¹™ (ë¬´í•œ ìŠ¤í¬ë¡¤, ì‹¤ì‹œê°„ ê²€ìƒ‰, ì¤‘ìš”ë„ ì •ë ¬)
globs: webui/src/routes/(app)/today/**/*.svelte, backend/app/routes/news.py
alwaysApply: false
version: 1.0
lastUpdated: 2025-11-14
---

# News Feature Development Rules

Agent Portalì˜ Today í˜ì´ì§€ ë‰´ìŠ¤ ê¸°ëŠ¥ ê°œë°œ ê·œì¹™ì…ë‹ˆë‹¤.

## Overview

ì´ ë¬¸ì„œëŠ” Today í˜ì´ì§€ì˜ ë‰´ìŠ¤ ê¸°ëŠ¥ ê°œë°œ íŒ¨í„´ì„ ì •ì˜í•©ë‹ˆë‹¤. ë¬´í•œ ìŠ¤í¬ë¡¤, ì‹¤ì‹œê°„ ê²€ìƒ‰ í•„í„°ë§, ì¤‘ìš”ë„ ê¸°ë°˜ ì •ë ¬, ëª¨ë‹¬ íŒì—…, Glassmorphism ë””ìì¸ ë“± í˜„ëŒ€ì ì¸ ë‰´ìŠ¤ í”¼ë“œ UI/UX íŒ¨í„´ì„ í¬í•¨í•©ë‹ˆë‹¤.

## Examples

### Example 1: ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„

**íŒ¨í„´**:
```svelte
<script lang="ts">
  import { onMount, afterUpdate } from 'svelte';
  
  let allArticles = [];
  let offset = 0;
  let hasMore = true;
  let loadingMore = false;
  let observerTarget: HTMLElement;
  let observer: IntersectionObserver;
  
  async function fetchMoreArticles() {
    if (loadingMore || !hasMore) return;
    loadingMore = true;
    
    try {
      const response = await fetch(`/api/news/articles?offset=${offset}&limit=20`);
      const data = await response.json();
      
      allArticles = [...allArticles, ...data.articles];
      offset += data.articles.length;
      hasMore = data.has_more;
    } catch (error) {
      console.error('Failed to fetch articles:', error);
    } finally {
      loadingMore = false;
    }
  }
  
  // afterUpdateì—ì„œ observer ì„¤ì • (DOM ì¤€ë¹„ ë³´ì¥)
  afterUpdate(() => {
    if (observerTarget && !observer) {
      observer = new IntersectionObserver(
        (entries) => {
          if (entries[0].isIntersecting && hasMore && !loadingMore) {
            fetchMoreArticles();
          }
        },
        { threshold: 0.1 }
      );
      observer.observe(observerTarget);
    }
  });
  
  onMount(() => {
    fetchMoreArticles();
    
    return () => {
      if (observer) observer.disconnect();
    };
  });
</script>

<!-- Article Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {#each allArticles as article}
    <div class="article-card">
      <h3>{article.title}</h3>
      <p>{article.summary}</p>
    </div>
  {/each}
</div>

<!-- Intersection Observer Target -->
<div bind:this={observerTarget} class="h-20"></div>

{#if loadingMore}
  <div class="text-center py-8">
    <div class="spinner"></div>
  </div>
{/if}
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `afterUpdate`ì—ì„œ observer ì„¤ì • (onMountëŠ” DOM ì¤€ë¹„ ë³´ì¥ ì•ˆ ë¨)
- `threshold: 0.1`ë¡œ ì¡°ê¸° ë¡œë”© (ìŠ¤í¬ë¡¤ ë ë„ë‹¬ ì „ ë¯¸ë¦¬ ë¡œë”©)
- `observerTarget`ì€ `h-20`ìœ¼ë¡œ ì¶©ë¶„í•œ ë†’ì´ í™•ë³´

### Example 2: ì‹¤ì‹œê°„ ê²€ìƒ‰ í•„í„°ë§

**íŒ¨í„´**:
```svelte
<script lang="ts">
  let searchQuery = '';
  let allArticles = [];
  let featuredArticles = [];
  let filteredArticles = [];
  let isSearching = false;
  
  function handleSearch() {
    if (!searchQuery.trim()) {
      filteredArticles = [];
      isSearching = false;
      return;
    }
    
    isSearching = true;
    const query = searchQuery.toLowerCase();
    
    // ì „ì²´ ê¸°ì‚¬ (featured + all) ê²€ìƒ‰
    const allToSearch = [...featuredArticles, ...allArticles];
    
    filteredArticles = allToSearch.filter(article => 
      article.title.toLowerCase().includes(query) ||
      article.content.toLowerCase().includes(query) ||
      article.summary?.toLowerCase().includes(query) ||
      article.tags?.some(tag => tag.toLowerCase().includes(query))
    ).sort((a, b) => b.importance_score - a.importance_score);
  }
  
  function clearSearch() {
    searchQuery = '';
    filteredArticles = [];
    isSearching = false;
  }
</script>

<!-- Search Bar -->
<div class="mb-6">
  <div class="relative max-w-2xl mx-auto">
    <input
      type="text"
      bind:value={searchQuery}
      on:input={handleSearch}
      placeholder="ì œëª©, ë‚´ìš©, íƒœê·¸ë¡œ ê²€ìƒ‰..."
      class="w-full px-5 py-3 pl-12 pr-12 rounded-xl bg-white/60 dark:bg-gray-800/60 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all"
    />
    
    <!-- Search Icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
      />
    </svg>
    
    <!-- Clear Button -->
    {#if searchQuery}
      <button
        on:click={clearSearch}
        class="absolute right-4 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    {/if}
  </div>
  
  <!-- Search Results Count -->
  {#if isSearching}
    <p class="text-center mt-3 text-sm text-gray-600 dark:text-gray-400">
      ğŸ” "{searchQuery}" ê²€ìƒ‰ ê²°ê³¼: {filteredArticles.length}ê°œ
    </p>
  {/if}
</div>
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `on:input`ìœ¼ë¡œ ì‹¤ì‹œê°„ í•„í„°ë§ (keydown ëŒ€ì‹ )
- ì—¬ëŸ¬ í•„ë“œ ë™ì‹œ ê²€ìƒ‰ (title, content, summary, tags)
- ì¤‘ìš”ë„ ìˆœ ì •ë ¬ (`importance_score` ë‚´ë¦¼ì°¨ìˆœ)
- Clear ë²„íŠ¼ìœ¼ë¡œ ê²€ìƒ‰ ì´ˆê¸°í™”

### Example 3: ì¤‘ìš”ë„ ê¸°ë°˜ ì •ë ¬ (Backend)

**íŒ¨í„´**:
```python
# backend/app/routes/news.py
from fastapi import APIRouter, Query, HTTPException
from typing import Dict, Any
from pathlib import Path
import json
from datetime import datetime

router = APIRouter(prefix="/api/news", tags=["news"])

@router.get("/articles")
async def get_articles(
    offset: int = Query(0, ge=0, description="Offset for pagination"),
    limit: int = Query(20, ge=1, le=100, description="Number of articles to return")
) -> Dict[str, Any]:
    """Get articles list for infinite scroll.
    
    Args:
        offset: Starting index
        limit: Number of articles to return
        
    Returns:
        Articles list with pagination info
        
    Raises:
        HTTPException: 404 if file not found, 500 for file read errors
    """
    try:
        today = datetime.now().strftime("%Y%m%d")
        data_path = settings.get_news_data_path()
        index_file = Path(data_path) / today / "articles_index.json"
        
        if not index_file.exists():
            raise HTTPException(
                status_code=404,
                detail=f"No articles found for date {today}"
            )
        
        with open(index_file, 'r', encoding='utf-8') as f:
            all_articles = json.load(f)
        
        # ì¤‘ìš”ë„ìˆœ ì •ë ¬ (importance_score ë‚´ë¦¼ì°¨ìˆœ)
        sorted_articles = sorted(
            all_articles,
            key=lambda x: x.get('importance_score', 0),
            reverse=True
        )
        
        # í˜ì´ì§€ë„¤ì´ì…˜
        total = len(sorted_articles)
        articles = sorted_articles[offset:offset + limit]
        
        return {
            "articles": articles,
            "total": total,
            "offset": offset,
            "limit": limit,
            "has_more": (offset + limit) < total
        }
        
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=500,
            detail=f"Failed to read articles: {str(e)}"
        )
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `importance_score` ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
- `offset` + `limit` í˜ì´ì§€ë„¤ì´ì…˜
- `has_more` í”Œë˜ê·¸ë¡œ ë¬´í•œ ìŠ¤í¬ë¡¤ ì œì–´

### Example 4: ëª¨ë‹¬ íŒì—… (ê¸°ì‚¬ ìƒì„¸)

**íŒ¨í„´**:
```svelte
<script lang="ts">
  let selectedArticle = null;
  
  function selectArticle(article) {
    selectedArticle = article;
    // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
    document.body.style.overflow = 'hidden';
  }
  
  function closeModal() {
    selectedArticle = null;
    document.body.style.overflow = '';
  }
</script>

<!-- Article Cards -->
{#each articles as article}
  <div
    class="article-card cursor-pointer"
    on:click={() => selectArticle(article)}
  >
    <h3>{article.title}</h3>
  </div>
{/each}

<!-- Modal -->
{#if selectedArticle}
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    on:click={closeModal}
  >
    <div
      class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
      on:click|stopPropagation
    >
      <!-- Modal Header -->
      <div class="sticky top-0 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm p-6 border-b border-gray-200 dark:border-gray-700">
        <button
          on:click={closeModal}
          class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
        >
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        
        <h2 class="text-2xl font-bold pr-12">{selectedArticle.title}</h2>
        <p class="text-sm text-gray-500 mt-2">{selectedArticle.media} Â· {selectedArticle.published_date}</p>
      </div>
      
      <!-- Modal Content -->
      <div class="p-6">
        <div class="prose prose-lg max-w-none dark:prose-invert">
          {#each selectedArticle.pages as page}
            <p>{page}</p>
          {/each}
        </div>
      </div>
    </div>
  </div>
{/if}
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸° (`on:click={closeModal}`)
- ëª¨ë‹¬ ë‚´ë¶€ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€ (`on:click|stopPropagation`)
- ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€ (`document.body.style.overflow`)
- `max-h-[90vh]` + `overflow-y-auto`ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥

## ì•„í‚¤í…ì²˜

### Frontend (SvelteKit)

**íŒŒì¼ êµ¬ì¡°**:
```
webui/src/routes/(app)/today/
â””â”€â”€ +page.svelte        # ë©”ì¸ í˜ì´ì§€
```

**ìƒíƒœ ê´€ë¦¬**:
- `featuredArticles`: ë©”íƒ€ ê¸°ì‚¬ (ìƒë‹¨ ê³ ì •)
- `allArticles`: ì „ì²´ ê¸°ì‚¬ (ë¬´í•œ ìŠ¤í¬ë¡¤)
- `filteredArticles`: ê²€ìƒ‰ ê²°ê³¼
- `selectedArticle`: ëª¨ë‹¬ì— í‘œì‹œí•  ê¸°ì‚¬

### Backend (FastAPI)

**íŒŒì¼ êµ¬ì¡°**:
```
backend/app/routes/
â””â”€â”€ news.py             # ë‰´ìŠ¤ API ì—”ë“œí¬ì¸íŠ¸
```

**ì—”ë“œí¬ì¸íŠ¸**:
- `GET /api/news/today`: ë©”íƒ€ ì •ë³´ ì¡°íšŒ
- `GET /api/news/article/{id}`: ê¸°ì‚¬ ìƒì„¸ ì¡°íšŒ
- `GET /api/news/articles`: ë¬´í•œ ìŠ¤í¬ë¡¤ìš© ê¸°ì‚¬ ëª©ë¡ (offset + limit)

### ë°ì´í„° êµ¬ì¡° (JSON)

**articles_meta.json**:
```json
{
  "crawl_date": "2025-11-13",
  "total_articles": 150,
  "categories": ["ì •ì¹˜", "ê²½ì œ", "ì‚¬íšŒ", "..."]
}
```

**articles_index.json**:
```json
[
  {
    "id": "20251113_001",
    "title": "ê¸°ì‚¬ ì œëª©",
    "summary": "ê¸°ì‚¬ ìš”ì•½ (3ì¤„)",
    "media": "ì–¸ë¡ ì‚¬",
    "published_date": "2025-11-13 08:00:00",
    "category": "ê²½ì œ",
    "importance_score": 8.5,
    "tags": ["íƒœê·¸1", "íƒœê·¸2"],
    "thumbnail_url": "/images/20251113_001.jpg"
  }
]
```

**articles_detail.json**:
```json
{
  "20251113_001": {
    "id": "20251113_001",
    "title": "ê¸°ì‚¬ ì œëª©",
    "content": "ì „ì²´ ê¸°ì‚¬ ë‚´ìš©",
    "media": "ì–¸ë¡ ì‚¬",
    "reporter": "ê¸°ìëª…",
    "published_date": "2025-11-13 08:00:00",
    "category": "ê²½ì œ",
    "tags": ["íƒœê·¸1", "íƒœê·¸2"],
    "related_articles": ["20251113_002", "20251113_003"]
  }
}
```

**articles_pages.json**:
```json
{
  "20251113_001": {
    "id": "20251113_001",
    "pages": [
      "ì²« ë²ˆì§¸ ë¬¸ë‹¨ ë‚´ìš©...",
      "ë‘ ë²ˆì§¸ ë¬¸ë‹¨ ë‚´ìš©...",
      "ì„¸ ë²ˆì§¸ ë¬¸ë‹¨ ë‚´ìš©..."
    ]
  }
}
```

## í™˜ê²½ ì„¤ì •

### ë‰´ìŠ¤ ë°ì´í„° ê²½ë¡œ

**backend/app/config.py**:
```python
class Settings(BaseSettings):
    # Environment
    ENVIRONMENT: str = "local"  # local, development, production, docker
    
    # News Data
    NEWS_DATA_PATH: str = "/data/news"  # Docker volume mount path
    NEWS_DATA_PATH_DEV: str = ""  # Development server path (set via env var)
    NEWS_DATA_PATH_LOCAL: str = "/Users/lchangoo/Workspace/mcp-naver-news/src/data"  # Local PC path
    
    def get_news_data_path(self) -> str:
        """í™˜ê²½ì— ë”°ë¥¸ ë‰´ìŠ¤ ë°ì´í„° ê²½ë¡œ ë°˜í™˜."""
        if self.ENVIRONMENT == "local":
            return self.NEWS_DATA_PATH_LOCAL
        elif self.ENVIRONMENT == "development" and self.NEWS_DATA_PATH_DEV:
            return self.NEWS_DATA_PATH_DEV
        else:
            return self.NEWS_DATA_PATH
```

**docker-compose.yml**:
```yaml
services:
  backend:
    environment:
      - ENVIRONMENT=docker
    volumes:
      - /Users/lchangoo/Workspace/mcp-naver-news/src/data:/data/news:ro
```

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìƒˆ ë‰´ìŠ¤ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ

Frontend:
- [ ] ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„ (afterUpdate + IntersectionObserver)
- [ ] ì‹¤ì‹œê°„ ê²€ìƒ‰ í•„í„°ë§ (on:input)
- [ ] ì¤‘ìš”ë„ ìˆœ ì •ë ¬ (importance_score)
- [ ] ëª¨ë‹¬ íŒì—… (ë°°ê²½ í´ë¦­, ìŠ¤í¬ë¡¤ ë°©ì§€)
- [ ] Glassmorphism ë””ìì¸ (backdrop-blur, íˆ¬ëª…ë„)
- [ ] ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼, íƒœë¸”ë¦¿, ë°ìŠ¤í¬í†±)

Backend:
- [ ] í™˜ê²½ë³„ ë°ì´í„° ê²½ë¡œ ì„¤ì • (config.py)
- [ ] ì¤‘ìš”ë„ ìˆœ ì •ë ¬ (sorted by importance_score desc)
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ (offset + limit)
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ (404, 500)
- [ ] Type hints ë° Docstring

## ê°€ë“œë ˆì¼

### âŒ ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ

1. **onMountì—ì„œ IntersectionObserver ì„¤ì •**:
   - âŒ `onMount(() => { observer = new IntersectionObserver(...) })`
   - âœ… `afterUpdate(() => { if (observerTarget && !observer) { ... } })`

2. **keydown ì´ë²¤íŠ¸ë¡œ ê²€ìƒ‰**:
   - âŒ `on:keydown={handleSearch}`
   - âœ… `on:input={handleSearch}` (ì‹¤ì‹œê°„ í•„í„°ë§)

3. **importance_score ìˆ«ì ë…¸ì¶œ**:
   - âŒ `<span>{article.importance_score}</span>`
   - âœ… ì ìˆ˜ëŠ” ì •ë ¬ì—ë§Œ ì‚¬ìš©, UIì—ëŠ” ë°°ì§€ë§Œ í‘œì‹œ

4. **ëª¨ë‹¬ ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€ ëˆ„ë½**:
   - âŒ ëª¨ë‹¬ ì—´ë¦¼ ì‹œ ë°°ê²½ ìŠ¤í¬ë¡¤ ê°€ëŠ¥
   - âœ… `document.body.style.overflow = 'hidden'`

## í•™ìŠµ ë‚´ìš©

### ì„±ê³µ ì‚¬ë¡€

1. **afterUpdateì—ì„œ observer ì„¤ì •**: onMountì—ì„œëŠ” DOM ì¤€ë¹„ ë³´ì¥ ì•ˆ ë¨
2. **threshold: 0.1**: ìŠ¤í¬ë¡¤ ë ë„ë‹¬ ì „ ë¯¸ë¦¬ ë¡œë”©ìœ¼ë¡œ UX ê°œì„ 
3. **ì¤‘ìš”ë„ ìˆœ ì •ë ¬**: ìµœì‹ ìˆœë³´ë‹¤ ì¤‘ìš”ë„ìˆœì´ ë‰´ìŠ¤ í”¼ë“œì— ë” ì í•©
4. **ê²€ìƒ‰ ê²°ê³¼ count í‘œì‹œ**: ì‚¬ìš©ìì—ê²Œ ê²€ìƒ‰ ê²°ê³¼ í”¼ë“œë°± ì œê³µ

### ì‹¤íŒ¨ ì‚¬ë¡€

1. **onMountì—ì„œ observer ì„¤ì •**: DOM ì¤€ë¹„ ì „ ì‹¤í–‰ë˜ì–´ observerTargetì´ undefined
2. **importance_score ìˆ«ì ë…¸ì¶œ**: ì‚¬ìš©ìì—ê²Œ í˜¼ë€, ë°°ì§€ë§Œ í‘œì‹œí•˜ëŠ” ê²ƒì´ ë” ì§ê´€ì 

## ì°¸ê³  ìë£Œ

- [Intersection Observer API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)
- [SvelteKit Lifecycle - afterUpdate](https://svelte.dev/docs/svelte#afterupdate)
- [Tailwind CSS Glassmorphism](https://tailwindcss.com/docs/backdrop-blur)
